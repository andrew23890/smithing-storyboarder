<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Smithing Storyboarder</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="./style.css" />
</head>
<body>
  <header class="app-header">
    <h1>Smithing Storyboarder</h1>
    <p class="app-tagline">From bar stock to forged story, one step at a time.</p>
  </header>

  <main class="app-main">
    <!-- Starting Stock Card -->
    <section class="card">
      <h2>Starting Stock</h2>
      <p class="card-intro">
        Tell the app what you’re starting with. We’ll compute the stock volume
        so later steps can keep your mass honest.
      </p>

      <div class="form-grid">
        <div class="field">
          <label for="stock-material">Material</label>
          <select id="stock-material">
            <option value="mild steel" selected>Mild steel</option>
            <option value="tool steel">Tool steel</option>
            <option value="stainless">Stainless steel</option>
            <option value="other">Other / unknown</option>
          </select>
        </div>

        <div class="field">
          <label for="stock-shape">Cross-section shape</label>
          <select id="stock-shape">
            <option value="square" selected>Square bar</option>
            <option value="round">Round bar</option>
            <option value="flat">Flat bar</option>
            <option value="rectangle">Rectangular bar</option>
          </select>
        </div>

        <div class="field">
          <label id="dim-a-label" for="stock-dim-a">Side (in chosen units)</label>
          <input
            id="stock-dim-a"
            type="number"
            min="0"
            step="0.001"
            placeholder="e.g. 0.625 for 5/8"
          />
        </div>

        <div class="field field-secondary" id="field-dim-b">
          <label id="dim-b-label" for="stock-dim-b">Thickness (in chosen units)</label>
          <input
            id="stock-dim-b"
            type="number"
            min="0"
            step="0.001"
            placeholder="e.g. 0.25"
          />
        </div>

        <div class="field">
          <label for="stock-length">Length</label>
          <input
            id="stock-length"
            type="number"
            min="0"
            step="0.01"
            placeholder="e.g. 30"
          />
        </div>

        <div class="field">
          <label for="stock-units">Units</label>
          <select id="stock-units">
            <option value="in" selected>Inches</option>
            <option value="mm">Millimeters</option>
            <option value="cm">Centimeters</option>
          </select>
        </div>
      </div>

      <button id="stock-calc-btn" type="button" class="primary-btn">
        Calculate Volume
      </button>

      <p id="stock-error" class="error-message" aria-live="polite"></p>
      <div id="stock-summary" class="stock-summary" aria-live="polite"></div>
    </section>

    <!-- Target Shape Card -->
    <section class="card">
      <h2>Target Shape</h2>
      <p class="card-intro">
        You can define a target by volume manually, or import a 3D shape (STL)
        and let the app compute its volume.
      </p>

      <!-- Manual volume section -->
      <h3 class="subheading">Manual target volume</h3>
      <div class="form-grid">
        <div class="field">
          <label for="target-label">Target name / label</label>
          <input
            id="target-label"
            type="text"
            placeholder="e.g. Leaf keychain, Scroll hook"
          />
        </div>

        <div class="field">
          <label for="target-volume">Target volume</label>
          <input
            id="target-volume"
            type="number"
            min="0"
            step="0.001"
            placeholder="e.g. 10.5"
          />
        </div>

        <div class="field">
          <label for="target-units">Units</label>
          <select id="target-units">
            <option value="in" selected>Inches³ match stock (in)</option>
            <option value="mm">Millimeters³ match stock (mm)</option>
            <option value="cm">Centimeters³ match stock (cm)</option>
          </select>
        </div>

        <div class="field">
          <label for="target-notes">Notes (optional)</label>
          <textarea
            id="target-notes"
            placeholder="Any notes about where this volume estimate came from."
          ></textarea>
        </div>
      </div>

      <button id="target-set-btn" type="button" class="primary-btn">
        Set Manual Target Shape
      </button>

      <p id="target-error" class="error-message" aria-live="polite"></p>

      <hr class="section-divider" />

      <!-- CAD / STL section -->
      <h3 class="subheading">Target from CAD (STL)</h3>
      <div class="form-grid">
        <div class="field">
          <label for="cad-file">STL file</label>
          <input id="cad-file" type="file" accept=".stl,.STL" />
        </div>

        <div class="field">
          <label for="cad-label">Name / label (optional)</label>
          <input
            id="cad-label"
            type="text"
            placeholder="If empty, the filename will be used."
          />
        </div>

        <div class="field">
          <label for="cad-units">Units for this STL</label>
          <select id="cad-units">
            <option value="in" selected>Inches</option>
            <option value="mm">Millimeters</option>
            <option value="cm">Centimeters</option>
          </select>
        </div>
      </div>

      <button id="cad-load-btn" type="button" class="primary-btn">
        Load STL and set target
      </button>

      <p id="cad-error" class="error-message" aria-live="polite"></p>

      <!-- Shared summary/comparison -->
      <div id="target-summary" class="stock-summary" aria-live="polite"></div>
      <div id="target-compare" class="stock-summary" aria-live="polite"></div>
    </section>

    <!-- Forging Steps Card -->
    <section class="card">
      <h2>Forging Steps</h2>
      <p class="card-intro">
        Define each major forging step. Operations like draw out, taper, scroll,
        twist, punch, drift, cut, weld, and more are available below. The app
        keeps a running volume budget so your final shape never has more volume
        than you started with (unless you add it on purpose).
      </p>

      <div class="form-grid steps-form-grid">
        <div class="field">
          <label for="steps-op">Operation</label>
          <select id="steps-op"></select>
        </div>

        <div class="field">
          <label for="steps-param-length">Length / region (optional)</label>
          <input
            id="steps-param-length"
            type="text"
            placeholder='e.g. "last 4 in", "middle third"'
          />
        </div>

        <div class="field">
          <label for="steps-param-location">Location (optional)</label>
          <input
            id="steps-param-location"
            type="text"
            placeholder='e.g. "bar end", "6 in from end"'
          />
        </div>

        <div class="field">
          <label id="steps-volume-delta-label" for="steps-volume-delta">
            Volume change
          </label>
          <input
            id="steps-volume-delta"
            type="number"
            min="0"
            step="0.001"
            placeholder="0"
          />
        </div>

        <div class="field">
          <label for="steps-description">Step description (optional)</label>
          <textarea
            id="steps-description"
            placeholder="If left blank, a default description will be generated."
          ></textarea>
        </div>
      </div>

      <div class="steps-actions">
        <button id="steps-add-btn" type="button" class="primary-btn">
          Add step
        </button>
        <button id="steps-clear-btn" type="button" class="secondary-btn">
          Clear all steps
        </button>
      </div>

      <p id="steps-error" class="error-message" aria-live="polite"></p>

      <div id="steps-list" class="steps-list"></div>
      <div
        id="steps-volume-summary"
        class="stock-summary"
        aria-live="polite"
      ></div>
    </section>

    <!-- Geometry Simulation Card -->
    <section class="card">
      <h2>Geometry Simulation (simple bar model)</h2>
      <p class="card-intro">
        This v0 engine treats the workpiece as a single bar segment. Volume-removing
        steps with a specified volume shorten the bar; volume-adding steps lengthen it.
        Shape-only steps (draw out, taper, scroll, twist, drift, etc.) are logged but
        don’t yet change length or cross-section.
      </p>

      <button id="geom-simulate-btn" type="button" class="primary-btn">
        Simulate bar after steps
      </button>

      <p id="geom-error" class="error-message" aria-live="polite"></p>
      <pre id="geom-output" class="stock-summary" aria-live="polite"></pre>
    </section>

    <!-- ForgeAI Hello Card -->
    <section class="card">
      <h2>ForgeAI Hello Check</h2>
      <p>
        This little button is just here to prove your JavaScript modules are alive.
      </p>
      <button id="hello-button" type="button">
        Say hello from ForgeAI
      </button>

      <div id="hello-output" class="hello-output" aria-live="polite"></div>
    </section>

    <!-- Status Card -->
    <section class="card">
      <h2>Status</h2>
      <ul class="status-list">
        <li>✅ Project files linked correctly</li>
        <li>✅ JavaScript modules enabled</li>
        <li>✅ Starting stock input &amp; volume (Phase 1)</li>
        <li>✅ Target shape model &amp; manual volume (Phase 1.2)</li>
        <li>✅ CAD-based target import (Phase 3 - STL volume)</li>
        <li>✅ Steps & operations model with UI (Phase 1.3)</li>
        <li>✅ Geometry engine v0 (simple bar, length vs volume)</li>
        <li>⬜ Geometry engine v1 (multi-segment, real tapers/scrolls)</li>
        <li>⬜ Auto-planned transformation sequence from stock to target</li>
      </ul>
    </section>
  </main>

  <footer class="app-footer">
    <small>Smithing Storyboarder &middot; ForgeAI helper loaded</small>
  </footer>

  <!-- Main JS entry point (ES module) -->
  <script type="module" src="./main.js"></script>
</body>
</html>
