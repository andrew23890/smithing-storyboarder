<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Smithing Storyboarder</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="./style.css" />
</head>
<body>
  <header class="app-header">
    <h1>Smithing Storyboarder</h1>
    <p class="app-tagline">From bar stock to forged story, one step at a time.</p>
  </header>

  <main class="app-main">
    <!-- Quick Hello / Wiring Check -->
    <section class="card">
      <h2>ForgeAI Hello</h2>
      <p class="card-intro">
        Click the button to confirm that the app wiring is working and the JS is loaded.
      </p>
      <button id="hello-button" class="primary-btn">Say hello</button>
      <p id="hello-output" class="hello-output"></p>
    </section>

    <!-- Starting Stock Card -->
    <section class="card">
      <h2>Starting Stock</h2>
      <p class="card-intro">
        Tell the app what you’re starting with. We’ll compute the stock volume and use it
        as your initial material budget.
      </p>

      <div class="form-grid">
        <!-- Material -->
        <div class="field">
          <label for="material">Material</label>
          <select id="material">
            <option value="">Select material…</option>
            <option value="mild-steel">Mild steel</option>
            <option value="tool-steel">Tool steel</option>
            <option value="stainless-steel">Stainless steel</option>
            <option value="wrought-iron">Wrought iron</option>
            <option value="unknown">Unknown / other</option>
          </select>
          <p id="stock-material-error" class="field-error-message"></p>
        </div>

        <!-- Shape -->
        <div class="field">
          <label for="stock-shape">Cross-section shape</label>
          <select id="stock-shape">
            <option value="">Select shape…</option>
            <option value="square">Square bar</option>
            <option value="round">Round bar</option>
            <option value="flat">Flat / rectangular bar</option>
            <option value="rectangle">Rectangular (thickness × width)</option>
          </select>
          <p id="stock-shape-error" class="field-error-message"></p>
        </div>

        <!-- Primary dimension (dim-a) -->
        <div class="field">
          <label for="dim-a">Primary dimension</label>
          <input
            id="dim-a"
            type="number"
            min="0"
            step="0.001"
            placeholder="e.g. 0.625"
          />
          <p class="field-hint">Side, diameter, or thickness depending on shape.</p>
          <p id="stock-dim-a-error" class="field-error-message"></p>
        </div>

        <!-- Secondary dimension (dim-b) - only for flat/rectangle -->
        <div class="field" id="dim-b-wrapper">
          <label for="dim-b">Secondary dimension</label>
          <input
            id="dim-b"
            type="number"
            min="0"
            step="0.001"
            placeholder="e.g. 1.5"
          />
          <p class="field-hint">Width for flat or rectangular stock.</p>
          <p id="stock-dim-b-error" class="field-error-message"></p>
        </div>

        <!-- Length -->
        <div class="field">
          <label for="length">Length</label>
          <input
            id="length"
            type="number"
            min="0"
            step="0.001"
            placeholder="e.g. 30"
          />
          <p id="stock-length-error" class="field-error-message"></p>
        </div>

        <!-- Units -->
        <div class="field">
          <label for="stock-units">Units</label>
          <select id="stock-units">
            <option value="">Select units…</option>
            <option value="in">Inches</option>
            <option value="mm">Millimeters</option>
            <option value="cm">Centimeters</option>
          </select>
          <p id="stock-units-error" class="field-error-message"></p>
        </div>
      </div>

      <div class="card-actions">
        <button id="stock-set-btn" class="primary-btn">
          Set starting stock
        </button>
      </div>

      <p id="stock-error" class="card-error"></p>
      <div id="stock-summary" class="stock-summary"></div>
    </section>

    <!-- Target Shape (Manual) -->
    <section class="card">
      <h2>Target Shape (Manual)</h2>
      <p class="card-intro">
        Describe your desired final piece using an approximate volume. This doesn’t need
        to be perfect—just good enough to reason about the material budget.
      </p>

      <div class="form-grid">
        <div class="field">
          <label for="target-label">Name / label</label>
          <input
            id="target-label"
            type="text"
            placeholder="e.g. Leaf keychain, Scroll hook"
          />
        </div>

        <div class="field">
          <label for="target-volume">Target volume</label>
          <input
            id="target-volume"
            type="number"
            min="0"
            step="0.001"
            placeholder="e.g. 10.5"
          />
        </div>

        <div class="field">
          <label for="target-units">Units</label>
          <select id="target-units">
            <option value="in">Inches³</option>
            <option value="mm">Millimeters³</option>
            <option value="cm">Centimeters³</option>
          </select>
        </div>

        <div class="field field-span-2">
          <label for="target-notes">Notes (optional)</label>
          <textarea
            id="target-notes"
            rows="2"
            placeholder="Any extra notes, proportions, or reminders about this target piece."
          ></textarea>
        </div>
      </div>

      <div class="card-actions">
        <button id="target-set-btn" class="primary-btn">
          Set manual target shape
        </button>
      </div>

      <p id="target-error" class="card-error"></p>
      <div id="target-summary" class="stock-summary"></div>
      <div id="target-compare" class="stock-summary"></div>
    </section>

    <!-- Target Shape (CAD / STL Import) -->
    <section class="card">
      <h2>Target Shape (CAD / STL Import)</h2>
      <p class="card-intro">
        Import an STL file to estimate its volume and use it as your target shape.
        A simple spinning preview will appear in the canvas below.
      </p>

      <div class="form-grid">
        <div class="field">
          <label for="cad-file">STL file</label>
          <input id="cad-file" type="file" accept=".stl" />
        </div>

        <div class="field">
          <label for="cad-units">STL units</label>
          <select id="cad-units">
            <option value="in">Inches</option>
            <option value="mm">Millimeters</option>
            <option value="cm">Centimeters</option>
          </select>
        </div>

        <div class="field field-span-2">
          <label for="cad-label">Label override (optional)</label>
          <input
            id="cad-label"
            type="text"
            placeholder="If left blank, the filename will be used."
          />
        </div>
      </div>

      <div class="card-actions">
        <button id="cad-load-btn" class="primary-btn">
          Load STL as target
        </button>
      </div>

      <p id="cad-error" class="card-error"></p>

      <div class="cad-preview-panel">
        <div class="cad-preview-canvas-wrapper">
          <canvas id="cad-preview" width="320" height="240"></canvas>
        </div>
        <p class="card-note">
          The preview is a simplified spinning wireframe to help you visually confirm the
          imported shape. It is not a full CAD viewer.
        </p>
      </div>
    </section>

    <!-- Forging Steps -->
    <section class="card">
      <h2>Forging Steps</h2>
      <p class="card-intro">
        Add the major forging operations you plan to perform. The volume budget panel
        will help you see whether your plan matches the material you have.
      </p>

      <div class="steps-form-grid">
        <!-- Operation -->
        <div class="field">
          <label for="step-operation">Operation</label>
          <select id="step-operation">
            <!-- Populated from operations.js -->
          </select>
        </div>

        <!-- Optional length parameter -->
        <div class="field">
          <label for="steps-param-length">Length affected (optional)</label>
          <input
            id="steps-param-length"
            type="text"
            placeholder="e.g. 4&quot; tip, 2&quot; near the eye"
          />
        </div>

        <!-- Optional location parameter -->
        <div class="field">
          <label for="steps-param-location">Location on bar (optional)</label>
          <input
            id="steps-param-location"
            type="text"
            placeholder="e.g. 3&quot; from one end, center section"
          />
        </div>

        <!-- Description -->
        <div class="field field-span-2">
          <label for="step-description">Description</label>
          <textarea
            id="step-description"
            rows="2"
            placeholder="Describe what you’ll do in this step in plain smith language."
          ></textarea>
        </div>

        <!-- Volume delta -->
        <div class="field">
          <label id="steps-volume-delta-label" for="step-delta-volume">
            Volume change (optional)
          </label>
          <input
            id="step-delta-volume"
            type="number"
            min="0"
            step="0.001"
            placeholder="0"
          />
          <p class="field-hint">
            If mass is conserved, leave this at 0. For cutting, punching, etc., estimate
            how much material is removed.
          </p>
        </div>

        <!-- Units for step volume -->
        <div class="field">
          <label for="step-units">Step volume units</label>
          <select id="step-units">
            <option value="in">Inches³</option>
            <option value="mm">Millimeters³</option>
            <option value="cm">Centimeters³</option>
          </select>
        </div>
      </div>

      <div class="card-actions card-actions-spaced">
        <button id="step-add-btn" class="primary-btn">
          Add step
        </button>
        <button id="steps-clear-btn" class="secondary-btn">
          Clear all steps
        </button>
      </div>

      <p id="steps-error" class="card-error"></p>

      <div id="steps-list" class="steps-list"></div>
      <div id="steps-volume-summary" class="stock-summary"></div>
    </section>

    <!-- Geometry Simulation -->
    <section class="card">
      <h2>Geometry Simulation (v0.1)</h2>
      <p class="card-intro">
        Run the simple geometry engine on your starting stock and steps. This treats
        the bar as idealized segments and gives you a textual narrative of how the shape
        changes after each step.
      </p>

      <div class="card-actions">
        <button id="geom-simulate-btn" class="primary-btn">
          Run geometry simulation
        </button>
      </div>

      <p id="geom-error" class="card-error"></p>
      <pre id="geom-output" class="geom-output"></pre>
    </section>

    <!-- Roadmap / Status (informational only) -->
    <section class="card">
      <h2>Roadmap Snapshot</h2>
      <p class="card-intro">
        This is a rough checklist of where the Smithing Storyboarder is heading.
        It’s just informational and doesn’t affect the app logic.
      </p>
      <ul class="roadmap-list">
        <li>✅ Phase 1: Starting stock volume &amp; basic UI</li>
        <li>✅ Phase 2: Target shape (manual &amp; STL), steps list, simple geometry</li>
        <li>⬜ Phase 3: Storyboard frame generator (cartoon panels)</li>
        <li>⬜ Phase 4: Local save/load &amp; sharing</li>
      </ul>
    </section>
  </main>

  <footer class="app-footer">
    <small>Smithing Storyboarder &middot; ForgeAI helper loaded</small>
  </footer>

  <!-- Main JS entry point (ES module) -->
  <script type="module" src="./main.js"></script>
</body>
</html>
