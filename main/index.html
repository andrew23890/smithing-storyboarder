<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Smithing Storyboarder</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="./style.css" />
</head>
<body>
  <header class="app-header">
    <h1>Smithing Storyboarder</h1>
    <p class="app-tagline">From bar stock to forged story, one step at a time.</p>
  </header>

  <main class="app-main">
    <!-- Quick Hello / Wiring Check -->
    <section class="card">
      <h2>ForgeAI Hello</h2>
      <p class="card-intro">
        Click the button to confirm that the app wiring is working and the JS is loaded.
      </p>
      <button id="hello-button" class="primary-btn">Say hello</button>
      <p id="hello-output" class="hello-output"></p>
    </section>

    <!-- Starting Stock -->
    <section class="card">
      <h2>Starting Stock</h2>
      <p class="card-intro">
        Define your starting bar stock. This is the material you have in hand before forging.
      </p>

      <div class="stock-form-grid">
        <!-- Material -->
        <div class="field">
          <label for="material">Material</label>
          <select id="material">
            <option value="">Select material…</option>
            <option value="mild_steel">Mild steel</option>
            <option value="tool_steel">Tool steel</option>
            <option value="stainless_steel">Stainless steel</option>
            <option value="unknown">Unknown / other</option>
          </select>
          <p id="material-error" class="field-error-message"></p>
        </div>

        <!-- Shape -->
        <div class="field">
          <label for="stock-shape">Stock shape</label>
          <select id="stock-shape">
            <option value="">Select shape…</option>
            <option value="round">Round bar</option>
            <option value="square">Square bar</option>
            <option value="flat">Flat / rectangular bar</option>
          </select>
          <p id="stock-shape-error" class="field-error-message"></p>
        </div>

        <!-- Dim A -->
        <div class="field">
          <label for="dim-a">
            Dim A
            <span class="hint">(diameter, or side/thickness)</span>
          </label>
          <input
            id="dim-a"
            type="number"
            min="0"
            step="0.001"
            placeholder="e.g. 0.625"
          />
          <p id="dim-a-error" class="field-error-message"></p>
        </div>

        <!-- Dim B (only for flat/rectangle) -->
        <div class="field" id="dim-b-wrapper">
          <label for="dim-b">
            Dim B
            <span class="hint">(width, for flat/rectangle)</span>
          </label>
          <input
            id="dim-b"
            type="number"
            min="0"
            step="0.001"
            placeholder="e.g. 1.5"
          />
          <p id="dim-b-error" class="field-error-message"></p>
        </div>

        <!-- Length -->
        <div class="field">
          <label for="length">Length</label>
          <input
            id="length"
            type="number"
            min="0"
            step="0.01"
            placeholder="e.g. 30"
          />
          <p id="stock-length-error" class="field-error-message"></p>
        </div>

        <!-- Units -->
        <div class="field">
          <label for="stock-units">Units</label>
          <select id="stock-units">
            <option value="">Select units…</option>
            <option value="in">Inches</option>
            <option value="mm">Millimeters</option>
            <option value="cm">Centimeters</option>
          </select>
          <p id="stock-units-error" class="field-error-message"></p>
        </div>
      </div>

      <div class="card-actions">
        <button id="stock-set-btn" class="primary-btn">
          Set starting stock
        </button>
      </div>

      <p id="stock-error" class="card-error"></p>
      <div id="stock-summary" class="stock-summary"></div>
    </section>

    <!-- Target Shape (Manual) -->
    <section class="card">
      <h2>Target Shape (Manual)</h2>
      <p class="card-intro">
        Describe the final forged piece. You can define a label, approximate volume,
        and any notes you want to remember.
      </p>

      <div class="target-form-grid">
        <div class="field">
          <label for="target-label">Name / label</label>
          <input
            id="target-label"
            type="text"
            placeholder="e.g. Leaf key fob, S-hook, hammer head"
          />
        </div>

        <div class="field">
          <label for="target-volume">Approximate volume</label>
          <input
            id="target-volume"
            type="number"
            min="0"
            step="0.001"
            placeholder="e.g. 2.5"
          />
        </div>

        <div class="field">
          <label for="target-units">Volume units</label>
          <select id="target-units">
            <option value="">Select units…</option>
            <option value="in">Inches³</option>
            <option value="mm">Millimeters³</option>
            <option value="cm">Centimeters³</option>
          </select>
        </div>

        <div class="field field-span-2">
          <label for="target-notes">Notes</label>
          <textarea
            id="target-notes"
            rows="3"
            placeholder="Describe the shape in smith-friendly terms (tapers, shoulders, transitions, etc.)"
          ></textarea>
        </div>
      </div>

      <div class="card-actions">
        <button id="target-set-btn" class="primary-btn">
          Set manual target
        </button>
      </div>

      <p id="target-error" class="card-error"></p>
      <div id="target-summary" class="stock-summary"></div>
      <div id="target-compare" class="target-compare"></div>
    </section>

    <!-- Target Shape (CAD/STL) -->
    <section class="card">
      <h2>Target Shape (CAD / STL Import)</h2>
      <p class="card-intro">
        Optionally import a simple triangle mesh (STL) of your target shape. The app
        will estimate volume and show a very minimal spinning preview.
      </p>

      <div class="cad-form-grid">
        <div class="field">
          <label for="cad-file">STL file</label>
          <input id="cad-file" type="file" accept=".stl" />
        </div>

        <div class="field">
          <label for="cad-units">STL units</label>
          <select id="cad-units">
            <option value="">Select units…</option>
            <option value="mm">Millimeters</option>
            <option value="cm">Centimeters</option>
            <option value="in">Inches</option>
          </select>
        </div>

        <div class="field">
          <label for="cad-label">Label (optional)</label>
          <input
            id="cad-label"
            type="text"
            placeholder="e.g. CAD model from Fusion"
          />
        </div>
      </div>

      <div class="card-actions">
        <button id="cad-load-btn" class="primary-btn">
          Load STL as target
        </button>
      </div>

      <p id="cad-error" class="card-error"></p>

      <div class="cad-summary-layout">
        <div id="cad-summary" class="stock-summary"></div>
        <div class="cad-preview-wrapper">
          <canvas id="cad-preview" width="260" height="200"></canvas>
          <p class="cad-preview-hint">
            This is a deliberately simplified spinning wireframe to help you visually confirm the
            imported shape. It is not a full CAD viewer.
          </p>
        </div>
      </div>
    </section>

    <!-- Forging Steps -->
    <section class="card">
      <h2>Forging Steps</h2>
      <p class="card-intro">
        Add the major forging operations you plan to perform. The volume budget panel
        will help you see whether your plan matches the material you have.
      </p>

      <div class="steps-form-grid">
        <!-- Operation -->
        <div class="field">
          <label for="step-operation">Operation</label>
          <select id="step-operation">
            <!-- Populated from operations.js -->
          </select>
        </div>

        <!-- Optional length parameter -->
        <div class="field">
          <label for="steps-param-length">Length affected (optional)</label>
          <input
            id="steps-param-length"
            type="text"
            placeholder="e.g. 4&quot; tip, 2&quot; near the eye"
          />
        </div>

        <!-- Optional location parameter -->
        <div class="field">
          <label for="steps-param-location">Location on bar (optional)</label>
          <input
            id="steps-param-location"
            type="text"
            placeholder="e.g. 3&quot; from one end, center section"
          />
        </div>

        <!-- Description (user text) -->
        <div class="field field-span-2">
          <label for="step-description">Description (optional)</label>
          <textarea
            id="step-description"
            rows="2"
            placeholder="e.g. Taper last 4&quot; from 5/8&quot; square to 1/4&quot; square"
          ></textarea>
        </div>

        <!-- Volume delta -->
        <div class="field">
          <label id="steps-volume-delta-label" for="step-delta-volume">
            Volume change (optional)
          </label>
          <input
            id="step-delta-volume"
            type="number"
            min="0"
            step="0.001"
            placeholder="0"
          />
          <p class="field-hint">
            If mass is conserved, leave this at 0. For cutting, punching, etc., estimate
            how much material is removed.
          </p>
        </div>

        <!-- Units for step volume -->
        <div class="field">
          <label for="step-units">Step volume units</label>
          <select id="step-units">
            <option value="in">Inches³</option>
            <option value="mm">Millimeters³</option>
            <option value="cm">Centimeters³</option>
          </select>
        </div>
      </div>

      <div class="card-actions card-actions-spaced">
        <button id="step-add-btn" class="primary-btn">
          Add step
        </button>
        <button id="steps-clear-btn" class="secondary-btn">
          Clear all steps
        </button>
      </div>

      <p id="steps-error" class="card-error"></p>

      <div id="steps-list" class="steps-list"></div>
      <div id="step-preview-panel" class="step-preview-panel">
        <h3 class="step-preview-title">Step preview (before/after)</h3>
        <p class="step-preview-placeholder">
          Click a step to see a simplified before/after outline of the bar here.
        </p>
      </div>
      <div id="steps-volume-summary" class="stock-summary"></div>
    </section>

    <!-- Geometry Simulation -->
    <section class="card">
      <h2>Geometry Simulation (v0.1)</h2>
      <p class="card-intro">
        Run the simple geometry engine on your starting stock and steps. This treats
        the bar as idealized segments and gives you a textual narrative of how the shape
        evolves.
      </p>

      <div class="card-actions">
        <button id="geom-simulate-btn" class="primary-btn">
          Run geometry simulation
        </button>
      </div>

      <p id="geom-error" class="card-error"></p>
      <pre id="geom-output" class="geom-output"></pre>
    </section>

    <!-- Roadmap / Status (informational only) -->
    <section class="card">
      <h2>Roadmap Snapshot</h2>
      <p class="card-intro">
        This is a rough roadmap of where the app is headed. Some boxes are already
        checked as features are implemented.
      </p>
      <ul class="roadmap-list">
        <li>✅ Phase 0: Basic HTML layout and wiring</li>
        <li>✅ Phase 1: Starting stock definition &amp; volume</li>
        <li>✅ Phase 2: Target shape definition &amp; comparison</li>
        <li>✅ Phase 3: Steps list, mass behavior, &amp; volume budget</li>
        <li>✅ Phase 4: Geometry engine (1D bar model) &amp; snapshots</li>
        <li>✅ Phase 5: App state, constraints, and heuristic preview</li>
        <li>✅ Phase 6: CAD/STL import and spinning preview</li>
        <li>⬜ Phase 7: Storyboard drawings &amp; thumbnails</li>
        <li>⬜ Phase 8: Local save/load &amp; sharing</li>
        <li>⬜ Phase 9: Advanced heuristics &amp; AI-assisted planning</li>
      </ul>
    </section>
  </main>

  <footer class="app-footer">
    <small>Smithing Storyboarder &middot; ForgeAI helper loaded</small>
  </footer>

  <!-- Main JS entry point (ES module) -->
  <script type="module" src="./main.js"></script>
</body>
</html>
