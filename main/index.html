<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Smithing Storyboarder</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="./style.css" />
</head>
<body>
  <header class="app-header">
    <h1>Smithing Storyboarder</h1>
    <p class="app-tagline">From bar stock to forged story, one step at a time.</p>
  </header>

  <main class="app-main">
    <!-- Starting Stock Card -->
    <section class="card">
      <h2>Starting Stock</h2>
      <p class="card-intro">
        Tell the app what you’re starting with. We’ll compute the stock volume
        so we can keep a volume budget as you forge.
      </p>

      <div class="form-grid">
        <div class="field">
          <label for="material">Material</label>
          <select id="material">
            <option value="mild_steel" selected>Mild steel</option>
            <option value="tool_steel">Tool steel (approx)</option>
            <option value="other">Other / unknown</option>
          </select>
        </div>

        <div class="field">
          <label for="stock-shape">Stock shape</label>
          <select id="stock-shape">
            <option value="round" selected>Round bar</option>
            <option value="square">Square bar</option>
            <option value="flat">Flat bar / plate</option>
            <option value="rectangle">Rectangular bar</option>
          </select>
        </div>

        <div class="field">
          <label for="dim-a">Primary dimension</label>
          <input
            id="dim-a"
            type="number"
            min="0"
            step="0.001"
            placeholder="e.g. 0.625"
          />
          <small class="field-help" id="dim-a-help">
            For round: diameter. For square: side. For flat/rect: thickness.
          </small>
        </div>

        <div class="field field-secondary" id="dim-b-wrapper">
          <label for="dim-b">Secondary dimension</label>
          <input
            id="dim-b"
            type="number"
            min="0"
            step="0.001"
            placeholder="e.g. 1.5"
          />
          <small class="field-help">
            Only used for flat/rectangular stock (width).
          </small>
        </div>

        <div class="field">
          <label for="length">Length</label>
          <input
            id="length"
            type="number"
            min="0"
            step="0.001"
            placeholder="e.g. 30"
          />
        </div>

        <div class="field">
          <label for="stock-units">Units</label>
          <select id="stock-units">
            <option value="in" selected>Inches (in)</option>
            <option value="mm">Millimeters (mm)</option>
            <option value="cm">Centimeters (cm)</option>
          </select>
        </div>
      </div>

      <button id="stock-set-btn" type="button" class="primary-btn">
        Set Starting Stock
      </button>

      <p id="stock-error" class="error-message" aria-live="polite"></p>
      <div id="stock-summary" class="stock-summary" aria-live="polite"></div>
    </section>

    <!-- Target Shape Card -->
    <section class="card">
      <h2>Target Shape</h2>
      <p class="card-intro">
        You can define a target by volume manually, or import a 3D shape (STL)
        and let the app compute its volume.
      </p>

      <!-- Manual volume section -->
      <h3 class="subheading">Manual target volume</h3>
      <div class="form-grid">
        <div class="field">
          <label for="target-label">Target name / label</label>
          <input
            id="target-label"
            type="text"
            placeholder="e.g. Leaf keychain, Scroll hook"
          />
        </div>

        <div class="field">
          <label for="target-volume">Target volume</label>
          <input
            id="target-volume"
            type="number"
            min="0"
            step="0.001"
            placeholder="e.g. 10.5"
          />
        </div>

        <div class="field">
          <label for="target-units">Units</label>
          <select id="target-units">
            <option value="in" selected>Inches³ match stock (in)</option>
            <option value="mm">Millimeters³ match stock (mm)</option>
            <option value="cm">Centimeters³ match stock (cm)</option>
          </select>
        </div>

        <div class="field">
          <label for="target-notes">Notes (optional)</label>
          <textarea
            id="target-notes"
            placeholder="Any notes about where this volume estimate came from."
          ></textarea>
        </div>
      </div>

      <button id="target-set-btn" type="button" class="primary-btn">
        Set Manual Target Shape
      </button>

      <p id="target-error" class="error-message" aria-live="polite"></p>

      <hr class="section-divider" />

      <!-- CAD / STL section -->
      <h3 class="subheading">Target from CAD (STL)</h3>
      <div class="form-grid">
        <div class="field">
          <label for="cad-file">STL file</label>
          <input id="cad-file" type="file" accept=".stl,.STL" />
        </div>

        <div class="field">
          <label for="cad-label">Name / label (optional)</label>
          <input
            id="cad-label"
            type="text"
            placeholder="If blank, we’ll use the file name."
          />
        </div>

        <div class="field">
          <label for="cad-units">Units</label>
          <select id="cad-units">
            <option value="in" selected>Inches³ match stock (in)</option>
            <option value="mm">Millimeters³ match stock (mm)</option>
            <option value="cm">Centimeters³ match stock (cm)</option>
          </select>
        </div>
      </div>

      <button id="cad-load-btn" type="button" class="primary-btn">
        Load STL and set target
      </button>

      <p id="cad-error" class="error-message" aria-live="polite"></p>

      <!-- Optional CAD visual preview -->
      <div class="cad-preview-wrapper">
        <h3 class="subheading">Visual preview (rough)</h3>
        <canvas
          id="cad-preview-canvas"
          width="320"
          height="220"
          aria-label="Approximate preview of the imported CAD shape"
        ></canvas>
        <p id="cad-preview-hint" class="helper-text">
          Load an STL to see a simple spinning point-cloud preview. It&apos;s just a sanity check, not exact CAD.
        </p>
      </div>

      <!-- Shared summary/comparison -->
      <div id="target-summary" class="stock-summary" aria-live="polite"></div>
      <div id="target-compare" class="stock-summary" aria-live="polite"></div>
    </section>

    <!-- Forging Steps Card -->
    <section class="card">
      <h2>Forging Steps</h2>
      <p class="card-intro">
        Define each major forging step. Operations like draw out, taper, scroll,
        twist, punch, drift, cut, weld, and more are available below. The app
        keeps a running volume budget so your final shape never has more volume
        than you started with (unless you add it on purpose).
      </p>

      <div class="form-grid steps-form-grid">
        <div class="field">
          <label for="step-operation">Operation</label>
          <select id="step-operation"></select>
        </div>

        <div class="field">
          <label for="step-description">Description</label>
          <input
            id="step-description"
            type="text"
            placeholder="e.g. Draw out square bar to 3/8&quot; over 6&quot;"
          />
        </div>

        <div class="field">
          <label for="step-delta-volume">Volume change (ΔV)</label>
          <input
            id="step-delta-volume"
            type="number"
            step="0.001"
            placeholder="e.g. 0 for pure reshaping"
          />
        </div>

        <div class="field">
          <label for="step-units">Units</label>
          <select id="step-units">
            <option value="in" selected>Inches³ (in³)</option>
            <option value="mm">Millimeters³ (mm³)</option>
            <option value="cm">Centimeters³ (cm³)</option>
          </select>
        </div>
      </div>

      <button id="step-add-btn" type="button" class="secondary-btn">
        Add Forging Step
      </button>

      <p id="steps-error" class="error-message" aria-live="polite"></p>

      <div id="steps-list" class="steps-list"></div>
      <div
        id="steps-volume-summary"
        class="stock-summary"
        aria-live="polite"
      ></div>
    </section>

    <!-- Debug / Hello Card -->
    <section class="card">
      <h2>ForgeAI Hello / Debug</h2>
      <p class="card-intro">
        Small debug helpers to make sure the app is wired up correctly.
      </p>

      <button id="hello-button" type="button">Say hello</button>
      <p id="hello-output" class="hello-output"></p>

      <div class="status-box">
        <h3 class="subheading">App status</h3>
        <ul class="status-list">
          <li id="status-stock">Starting stock: (not set)</li>
          <li id="status-target">Target shape: (not set)</li>
          <li id="status-steps">Steps: 0 defined</li>
        </ul>
      </div>
    </section>

    <!-- Roadmap Card (read-only) -->
    <section class="card">
      <h2>Roadmap (MVP focus)</h2>
      <p class="card-intro">
        This is a quick snapshot of what we’re building toward. We’re currently
        working through Phase 2 and 3 items.
      </p>

      <h3 class="subheading">Phase 1 – Basic stock &amp; target</h3>
      <ul class="roadmap-list">
        <li>✅ Enter starting stock dimensions and compute volume</li>
        <li>✅ Enter a simple target volume by hand</li>
        <li>✅ Show stock vs target volume comparison</li>
      </ul>

      <h3 class="subheading">Phase 2 – Steps &amp; volume budget</h3>
      <ul class="roadmap-list">
        <li>✅ Define discrete forging steps with volume changes</li>
        <li>✅ Track cumulative volume change and remaining budget</li>
        <li>✅ Warn when steps would exceed starting volume</li>
      </ul>

      <h3 class="subheading">Phase 3 – CAD upload &amp; target volume</h3>
      <ul class="roadmap-list">
        <li>✅ Import simple STL file and estimate volume</li>
        <li>✅ Use STL-based volume as target shape</li>
        <li>⬜ Basic visual preview of imported CAD (rough)</li>
      </ul>

      <h3 class="subheading">Phase 4 – Geometry engine (future)</h3>
      <ul class="roadmap-list">
        <li>⬜ Bar state representation (length, cross-section per segment)</li>
        <li>⬜ Simple operations (draw out, taper, upset, bend, twist)</li>
        <li>⬜ Volume-preserving checks per operation</li>
      </ul>

      <h3 class="subheading">Phase 5 – Auto-planning (future)</h3>
      <ul class="roadmap-list">
        <li>⬜ Geometry engine v1 (multi-segment, real tapers/scrolls)</li>
        <li>⬜ Auto-planned transformation sequence from stock to target</li>
      </ul>
    </section>
  </main>

  <footer class="app-footer">
    <small>Smithing Storyboarder &middot; ForgeAI helper loaded</small>
  </footer>

  <!-- Main JS entry point (ES module) -->
  <script type="module" src="./main.js"></script>
</body>
</html>
